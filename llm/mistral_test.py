from mlx_lm import load, generate

# Path to your local model folder (adjust as needed)
model_name = "mlx-community/Mistral-7B-Instruct-v0.3-4bit"

# Load the model and tokenizer
model, tokenizer = load(model_name)

# Your system prompt (adjust as needed)
system_prompt = """
You are an exceptionally gifted and compassionate tarot reader with over 20 years of experience. Your readings are known for their profound insight, gentle wisdom, and ability to provide comfort while delivering truth with love.\n\nCORE PRINCIPLES:\n• Approach each reading with deep empathy and genuine care for the querent's wellbeing\n• See beyond surface meanings to reveal the soul's deeper journey and lessons\n• Honor both light and shadow aspects while maintaining hope and empowerment\n• Weave individual card meanings into a cohesive, flowing narrative\n• Speak to the human experience with authenticity and warmth\n\nREADING STYLE:\n• Use a warm, conversational tone as if speaking to a dear friend\n• Begin with gentle acknowledgment of the querent's situation\n• Build connections between cards to show the fuller story\n• Include specific, actionable guidance alongside spiritual insights\n• End with encouragement and practical next steps\n\nSYNTHESIS APPROACH:\n• Look for themes, patterns, and energy flows across all cards\n• Note contrasts and tensions that reveal important dynamics\n• Connect past influences to present circumstances and future potential\n• Use card combinations to reveal deeper layers of meaning\n• Address the psychological, spiritual, and practical dimensions\n\nRemember: You're not just interpreting cards - you're offering sacred guidance to a soul seeking clarity and growth.
"""

# Simulate a user prompt with context (e.g., from your spread)
user_prompt = (
    'Please provide a complete tarot reading for this question: "What do I need to let go of?"\n\nREADING DETAILS:\n• Question Type: general\n• Spread: 3 Cards (Past, Present, Future) - Classic timeline spread showing the flow of energy\n• Cards Drawn: Knight of Pentacles (upright) in Past | Four of Cups (reversed) in Present | Two of Pentacles (reversed) in Future\n\n\nGENERAL READING FOCUS:\n• Look for the underlying theme or spiritual curriculum being offered\n• Address life transitions, growth opportunities, and personal evolution\n• Consider how different life areas may be interconnected\n• Explore both current circumstances and longer-term life direction\n• Balance immediate practical needs with soul growth and purpose\nShow how past influences have created current circumstances and where things are naturally heading. Emphasize the flow of energy and story arc.\n\nCONTEXT AND CARD MEANINGS:\nREADING OVERVIEW:\nQuestion: "What do I need to let go of?"\nQuestion Type: general (confidence: 0.8)\nSpread: 3 Cards (Past, Present, Future) - Classic timeline spread showing the flow of energy\nCards Drawn: 3\n\nCARDS DRAWN:\n• Past: Knight of Pentacles (Upright)\n• Present: Four of Cups (Reversed)\n• Future: Two of Pentacles (Reversed)\n\nPOSITION INTERPRETATIONS:\n\nPast: Knight of Pentacles (upright)\nPosition Meaning: What experiences, decisions, patterns, or energies from your past are directly influencing your current situation? This could be recent events, learned behaviors, past relationships, or even ancestral patterns. What foundation - positive or challenging - was laid that brings you to this moment?\nCard in Position: Past dedication and consistent efforts have laid a strong foundation for your current stability and growth. Your reliable nature shaped your progress.\nPsychological: Represents the part of us that values consistency and reliability, focusing on long-term success over immediate gratification.\nSpiritual: An invitation to cultivate spiritual growth through earthly tasks. The soul\'s journey towards enlightenment through persistent effort.\nPractical: Focus on your work and responsibilities. Achievements come through incremental efforts and unwavering commitment.\nKeywords: diligence, patience, reliability, hard work, responsibility, steadiness, practicality, routine, history, influences, foundation, patterns\nPosition-Specific: Past dedication and consistent efforts have laid a strong foundation for your current stability and growth. Your reliable nature shaped your progress.\n\nPresent: Four of Cups (reversed)\nPosition Meaning: What is the core energy, central theme, or primary dynamic of your current experience? This represents where you are right now - emotionally, spiritually, and practically. What circumstances, opportunities, or challenges are actively shaping your daily reality?\nCard in Position: You are emerging from contemplation, feeling ready to engage with renewed clarity and understanding.\nPsychological: Breaking free from emotional numbness or depression, ready to engage anew with life’s possibilities.\nSpiritual: Emerging from a spiritual retreat with fresh insights and a renewed connection to the divine flow.\nPractical: Opportunities once ignored become appealing, prompting action and appreciation for what life brings.\nKeywords: withdrawal, new awareness, acceptance, gratitude, emotional opening, re-engagement, now, current, energy, circumstances, reality, opportunities\nPosition-Specific: You are emerging from contemplation, feeling ready to engage with renewed clarity and understanding.\n\nFuture: Two of Pentacles (reversed)\nPosition Meaning: Where is your current path leading? What outcome, opportunity, or new phase of life is emerging based on your present circumstances and choices? This represents the natural progression of current energies, not a fixed fate but a likely trajectory if things continue as they are.\nCard in Position: Future complications may arise if imbalance and disorganization continue without correction.\nPsychological: The mind grappling with the inability to focus, leading to anxiety and scattered thoughts.\nSpiritual: Disconnected from your inner harmony, caught in the material world\'s demands without spiritual grounding.\nPractical: Urgency to reassess commitments and schedule to regain equilibrium; prioritize what truly matters.\nKeywords: imbalance, overwhelm, disorganization, chaos, neglect, stress, outcome, potential, direction, trajectory, emerging, progression\nPosition-Specific: Future complications may arise if imbalance and disorganization continue without correction.\n\nJOURNALING PROMPTS:\n\nKnight of Pentacles: Where can I bring more consistency and dedication in my life?\n\nFour of Cups: What emotions arise when I contemplate life’s current offerings?\n\nTwo of Pentacles: What areas of my life are demanding greater balance?\n\nREADING INSTRUCTIONS:\nCreate a flowing, holistic reading that:\n\n1. **Opens with Connection**: Acknowledge the querent\'s question with warmth and understanding\n\n2. **Reveals the Story**: Synthesize the cards into a coherent narrative that shows:\n   - How past influences shaped the current situation\n   - What energies and dynamics are active now\n   - Where things are naturally heading\n   - How different aspects of life are interconnected\n\n3. **Explores Key Themes**: Identify and explore 2-3 major themes emerging from the cards, such as:\n   - Growth through challenge\n   - Balancing different aspects of life\n   - Healing and transformation\n   - Relationships and connection\n   - Personal power and authenticity\n\n4. **Provides Practical Wisdom**: Include specific, actionable guidance that addresses:\n   - Mindset shifts that would be beneficial\n   - Concrete steps to take in the coming weeks\n   - How to work with current energies\n   - What to be mindful of or avoid\n\n5. **Honors Card Interactions**: Pay special attention to:\n   - Card combinations and their amplified meanings\n   - Contrasts that reveal important tensions\n   - Progressive flows from past through future\n   - How position meanings enhance card interpretations\n\n6. **Closes with Empowerment**: End with encouragement and a clear sense of hope and possibility\n\nWrite in paragraphs, not bullet points. Let the reading flow naturally from insight to insight. Aim for 400-600 words that feel like a wise friend sharing profound insights.\n\n',
)


# Combine for full prompt
full_prompt = f"<|system|>\n{system_prompt}\n<|user|>\n{user_prompt}\n<|assistant|>\n"

# Generate response
response = generate(model, tokenizer, prompt=full_prompt, max_tokens=2000)

# Print output
print("----- Response -----")
print(response)
